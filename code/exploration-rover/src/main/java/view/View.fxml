<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.canvas.Canvas?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Pane?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.shape.Ellipse?>
<?import javafx.scene.shape.Line?>
<?import javafx.scene.text.Text?>

<BorderPane prefHeight="900" prefWidth="1280" styleClass="root" stylesheets="@styles.css" xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" fx:controller="view.View">

    <!-- TOP BAR -->
    <top>
        <HBox alignment="CENTER_LEFT" spacing="12" styleClass="topbar">
            <padding>
                <Insets bottom="14" left="14" right="14" top="14" />
            </padding>

            <Label styleClass="statusDot" text="*" />

            <VBox spacing="2">
                <Label styleClass="title" text="Tableau de bord Sonar et Capteurs" />
                <Label styleClass="subtitle" text="Monitoring System v1.5" />
            </VBox>

            <Region HBox.hgrow="ALWAYS" />

            <Label fx:id="lblStatusPill" styleClass="pill" text="Status : En ligne" />
            <Button styleClass="iconBtn" text="[ ]" />
        </HBox>
    </top>
    <center>
        <VBox spacing="14" styleClass="page" BorderPane.alignment="CENTER">
            <padding>
                <Insets bottom="14" left="14" right="14" top="14" />
            </padding>

            <!-- Main row -->
            <HBox spacing="14">

                <!-- SONAR -->
                <VBox spacing="10" styleClass="card" HBox.hgrow="ALWAYS">
                    <HBox alignment="CENTER_LEFT">
                        <VBox spacing="2">
                            <Label styleClass="cardTitle" text="Visualisation Sonar" />
                            <Label styleClass="cardSub" text="Scan statique - Portée: 12cm" />
                        </VBox>
                        <Region HBox.hgrow="ALWAYS" />
                    </HBox>

                    <!-- Zone sonar (dessin simple) -->
                    <StackPane styleClass="panel">
                        <Pane prefHeight="436.0" prefWidth="762.0">
                            <Line endX="-100.0" endY="393.0" layoutX="176.0" layoutY="52.0" startX="-100.0" startY="-53.0" styleClass="sonarGraduation" />
                            <Ellipse fx:id="cl120" layoutX="381.0" layoutY="98.0" radiusX="11.0" radiusY="9.0" stroke="BLACK" strokeType="INSIDE" styleClass="sonarBlipBlack" />
                            <!-- Graduations principales (200 mm) et secondaires (100 mm, plus courtes) -->
                            <Line endX="25.0" layoutX="177.0" layoutY="400.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="15.0" layoutX="177.0" layoutY="389.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="25.0" layoutX="177.0" layoutY="371.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="15.0" layoutX="177.0" layoutY="353.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="25.0" layoutX="177.0" layoutY="336.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="15.0" layoutX="177.0" layoutY="318.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="25.0" layoutX="177.0" layoutY="300.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="15.0" layoutX="177.0" layoutY="282.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="25.0" layoutX="177.0" layoutY="264.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="15.0" layoutX="177.0" layoutY="246.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="25.0" layoutX="177.0" layoutY="229.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="15.0" layoutX="177.0" layoutY="211.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="25.0" layoutX="177.0" layoutY="193.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="15.0" layoutX="177.0" layoutY="175.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="25.0" layoutX="177.0" layoutY="157.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="15.0" layoutX="177.0" layoutY="139.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="25.0" layoutX="177.0" layoutY="121.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="15.0" layoutX="177.0" layoutY="104.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="25.0" layoutX="177.0" layoutY="86.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="15.0" layoutX="177.0" layoutY="68.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Line endX="25.0" layoutX="177.0" layoutY="50.0" startX="-100.0" styleClass="sonarGraduation" />
                            <Text layoutX="28.0" layoutY="404.0" strokeType="OUTSIDE" strokeWidth="0.0" styleClass="sonarGraduationText" text="40mm" />
                            <Text layoutX="28.0" layoutY="375.0" strokeType="OUTSIDE" strokeWidth="0.0" styleClass="sonarGraduationText" text="200mm" />
                            <Text layoutX="24.0" layoutY="339.0" strokeType="OUTSIDE" strokeWidth="0.0" styleClass="sonarGraduationText" text="400mm" />
                            <Text layoutX="24.0" layoutY="302.0" strokeType="OUTSIDE" strokeWidth="0.0" styleClass="sonarGraduationText" text="600mm" />
                            <Text layoutX="24.0" layoutY="266.0" strokeType="OUTSIDE" strokeWidth="0.0" styleClass="sonarGraduationText" text="800mm" />
                            <Text layoutX="24.0" layoutY="231.0" strokeType="OUTSIDE" strokeWidth="0.0" styleClass="sonarGraduationText" text="1000mm" />
                            <Text layoutX="24.0" layoutY="195.0" strokeType="OUTSIDE" strokeWidth="0.0" styleClass="sonarGraduationText" text="1200mm" />
                            <Text layoutX="24.0" layoutY="159.0" strokeType="OUTSIDE" strokeWidth="0.0" styleClass="sonarGraduationText" text="1400mm" />
                            <Text layoutX="24.0" layoutY="123.0" strokeType="OUTSIDE" strokeWidth="0.0" styleClass="sonarGraduationText" text="1600mm" />
                            <Text layoutX="24.0" layoutY="88.0" strokeType="OUTSIDE" strokeWidth="0.0" styleClass="sonarGraduationText" text="1800mm" />
                            <Text layoutX="24.0" layoutY="54.0" strokeType="OUTSIDE" strokeWidth="0.0" styleClass="sonarGraduationText" text="2000mm" />
                            <!-- Point dynamique qui suit la distance -->
                            <Ellipse fx:id="sonarDot" layoutX="381.0" layoutY="400.0" radiusX="12.0" radiusY="10.0" style="-fx-fill: #2ee58f; -fx-stroke: transparent;" />
                        </Pane>
                    </StackPane>

                    <HBox spacing="8" alignment="CENTER_LEFT">
                        <Label styleClass="muted" text="DISTANCE :" />
                        <Label fx:id="lblSonarDistance" styleClass="bigValue" prefWidth="80" text="—" />
                        <Label styleClass="unit" text="mm" />
                        <Region HBox.hgrow="ALWAYS" />
                        <Label fx:id="lblSonarStatus" styleClass="mutedSmall" text="Sonar: ?" />
                    </HBox>
                </VBox>

                <!-- RIGHT SENSORS -->
                <VBox prefWidth="360" spacing="10" styleClass="card">
                    <HBox alignment="CENTER_LEFT">
                        <Label styleClass="cardTitle" text="Données Capteurs" />
                        <Region HBox.hgrow="ALWAYS" />
                        <Button fx:id="btnReinitialiser" styleClass="linkBtn" text="Generer PDF mission" />
                    </HBox>

                    <!-- Temp -->
                    <VBox spacing="8" styleClass="miniCard">
                        <Label styleClass="miniTitle" text="Température" />
                        <HBox alignment="BASELINE_LEFT" spacing="6">
                            <Label fx:id="lblTemperature" styleClass="bigValue" />
                            <Label styleClass="unit" text="°C" />
                        </HBox>
                        <Label styleClass="mutedSmall" text="Moyenne: 24.1°C" />
                    </VBox>

                    <!-- Humidité -->
                    <VBox spacing="8" styleClass="miniCard">
                        <Label styleClass="miniTitle" text="Humidité relative" />
                        <HBox alignment="BASELINE_LEFT" spacing="6">
                            <Label fx:id="lblHumidite" styleClass="bigValue" />
                            <!-- IMPORTANT: pour afficher % seul => "%%" -->
                            <Label styleClass="unit" text="%%" />
                        </HBox>
                        <Label styleClass="mutedSmall" text="Zone de confort" />
                    </VBox>

                    <!-- Lumière -->
                    <VBox spacing="8" styleClass="miniCard">
                        <Label styleClass="miniTitle" text="Intensité lumière" />
                        <HBox alignment="BASELINE_LEFT" spacing="6">
                            <Label fx:id="lblLuminosite" styleClass="bigValue" />
                            <Label styleClass="unit" text="Lux" />
                        </HBox>
                        <Label styleClass="mutedSmall" />
                    </VBox>

                    <VBox spacing="8" styleClass="miniCard">
                        <Label styleClass="miniTitle" text="Message système" />
                        <Label fx:id="lblMessage" styleClass="sensorMessage" text="..." wrapText="true" />
                    </VBox>
                </VBox>

            </HBox>

            <!-- FIL D'ARIANE -->
            <VBox spacing="10" styleClass="card" VBox.vgrow="ALWAYS">
                <HBox alignment="CENTER_LEFT">
                    <VBox spacing="2">
                        <Label styleClass="cardTitle" text="Fil d'Ariane" />
                        <Label styleClass="cardSub" text="Suivi de trajectoire" />
                    </VBox>
                    <Region HBox.hgrow="ALWAYS" />
                    <Label fx:id="lblFilArianeStats" styleClass="pill" text="X: 0.00  Y: 0.00  Dist: 0.0m" minWidth="220" prefWidth="220" maxWidth="220" alignment="CENTER_RIGHT" />
                </HBox>

                <StackPane fx:id="filArianeContainer" minHeight="160" prefHeight="220" styleClass="panel" VBox.vgrow="ALWAYS">
                    <Canvas fx:id="filArianeCanvas" />
                </StackPane>
            </VBox>

        </VBox>
    </center>

</BorderPane>
